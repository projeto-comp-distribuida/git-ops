# Environment-specific values for auth service in dev
# These values override the defaults in apps/auth/values.yaml

image:
  repository: distrischooldevacr.azurecr.io/microservice-auth
  tag: "latest"
  pullPolicy: Always

imagePullSecrets:
  - name: acr-secret

replicaCount: 1

resources:
  limits:
    cpu: 500m
    memory: 1Gi  # Keep at 1Gi - idle usage ~341Mi, but Spring Boot apps can use 2-3x under load
  requests:
    cpu: 100m
    memory: 400Mi  # Optimized: idle ~341Mi, reduced from 512Mi but still provides buffer for normal operation

env:
  - name: ENVIRONMENT
    value: "dev"
  - name: LOG_LEVEL
    value: "DEBUG"
  - name: SPRING_DATASOURCE_DRIVER_CLASS_NAME
    value: "org.postgresql.Driver"
  - name: SPRING_REDIS_HOST
    value: "redis.infrastructure-dev"
  - name: SPRING_REDIS_PORT
    value: "6379"
  - name: SPRING_REDIS_PASSWORD
    value: ""
  - name: KAFKA_BOOTSTRAP_SERVERS
    value: "kafka.infrastructure-dev:29092"
  - name: SPRING_KAFKA_PRODUCER_COMPRESSION_TYPE
    value: "none"
  - name: SERVER_PORT
    value: "8080"
  - name: GRPC_SERVER_PORT
    value: "9090"
  - name: ALLOWED_ORIGINS
    value: "*"
  - name: MAX_LOGIN_ATTEMPTS
    value: "5"
  - name: ACCOUNT_LOCK_DURATION
    value: "30"
  - name: PASSWORD_RESET_TOKEN_EXPIRATION
    value: "2"
  - name: EMAIL_VERIFICATION_TOKEN_EXPIRATION
    value: "24"
  - name: SPRING_FLYWAY_ENABLED
    value: "true"
  - name: SPRING_FLYWAY_LOCATIONS
    value: "classpath:db/migration"
  - name: SPRING_FLYWAY_BASELINE_ON_MIGRATE
    value: "true"
  - name: SPRING_FLYWAY_IGNORE_MISSING_MIGRATIONS
    value: "true"
  - name: SPRING_FLYWAY_VALIDATE_ON_MIGRATE
    value: "true"
  - name: SPRING_FLYWAY_CLEAN_ON_VALIDATION_ERROR
    value: "true"
  - name: SPRING_FLYWAY_OUT_OF_ORDER
    value: "false"
  - name: AUTH0_ENABLED
    value: "true"
  - name: AUTH0_CONNECTION
    value: "Username-Password-Authentication"
  - name: ACR_REGISTRY
    value: "distrischooldevacr.azurecr.io"
  - name: NEXT_PUBLIC_API_URL
    value: "http://distrischool-api-gateway-dev.api-gateway-dev:80"
  - name: NEXT_PUBLIC_AUTH_SERVICE_URL
    value: "http://distrischool-api-gateway-dev.api-gateway-dev:80/api/auth"
  - name: NEXT_PUBLIC_STUDENT_SERVICE_URL
    value: "http://distrischool-api-gateway-dev.api-gateway-dev:80/api/students"
  - name: NEXT_PUBLIC_TEACHER_SERVICE_URL
    value: "http://distrischool-api-gateway-dev.api-gateway-dev:80/api/teachers"

secrets:
  enabled: false
  secretName: "auth-dev-secrets"
  # Secrets are created externally using scripts/create-secrets.sh
  # Do not store secret data in Git!

sealedSecrets:
  enabled: false


ingress:
  enabled: false
  className: ""
  hosts: []

probe:
  startup:
    enabled: true
    useTcpSocket: true  # Use TCP socket instead of HTTP - faster and checks if port is open
    path: /api/v1/auth/health  # Only used if useTcpSocket is false
    initialDelaySeconds: 120  # Increased from 60 - allow more time before first probe
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 90  # Increased from 60 - Total: 120 + (90 * 10) = 1020 seconds = 17 minutes max startup time
  liveness:
    enabled: true
    path: /api/v1/auth/health
    initialDelaySeconds: 120
    periodSeconds: 30
    timeoutSeconds: 5
    failureThreshold: 3
  readiness:
    enabled: true
    path: /api/v1/auth/health
    initialDelaySeconds: 60
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

