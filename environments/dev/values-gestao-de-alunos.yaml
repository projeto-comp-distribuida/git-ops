image:
  repository: distrischooldevacr.azurecr.io/microservice-student-management-service
  tag: "latest"

imagePullSecrets:
  - name: acr-secret

replicaCount: 1

resources:
  limits:
    cpu: 500m
    # Memory limits removed to allow faster startup - Spring Boot needs more memory during initialization
  requests:
    cpu: 100m
    # Memory requests removed to allow faster startup - Spring Boot needs more memory during initialization

env:
  - name: ENVIRONMENT
    value: "dev"
  - name: LOG_LEVEL
    value: "DEBUG"
  - name: SPRING_DATASOURCE_DRIVER_CLASS_NAME
    value: "org.postgresql.Driver"
  - name: SPRING_JPA_HIBERNATE_DDL_AUTO
    value: "none"
  - name: SPRING_JPA_PROPERTIES_HIBERNATE_DIALECT
    value: "org.hibernate.dialect.PostgreSQLDialect"
  - name: SPRING_REDIS_HOST
    value: "redis.infrastructure-dev"
  - name: SPRING_REDIS_PORT
    value: "6379"
  - name: SPRING_REDIS_PASSWORD
    value: ""
  - name: KAFKA_BOOTSTRAP_SERVERS
    value: "kafka.infrastructure-dev:29092"
  - name: SPRING_KAFKA_PRODUCER_COMPRESSION_TYPE
    value: "none"
  - name: SERVER_PORT
    value: "8080"
  - name: GRPC_SERVER_PORT
    value: "9090"
  - name: ALLOWED_ORIGINS
    value: "*"
  - name: MAX_LOGIN_ATTEMPTS
    value: "5"
  - name: ACCOUNT_LOCK_DURATION
    value: "30"
  - name: PASSWORD_RESET_TOKEN_EXPIRATION
    value: "2"
  - name: EMAIL_VERIFICATION_TOKEN_EXPIRATION
    value: "24"
  - name: SPRING_FLYWAY_ENABLED
    value: "true"
  - name: SPRING_FLYWAY_LOCATIONS
    value: "classpath:db/migration"
  - name: SPRING_FLYWAY_BASELINE_ON_MIGRATE
    value: "true"
  - name: SPRING_FLYWAY_REPAIR_ON_MIGRATE
    value: "true"
  - name: SPRING_FLYWAY_OUT_OF_ORDER
    value: "true"
  - name: AUTH0_ENABLED
    value: "true"
  - name: AUTH0_CONNECTION
    value: "Username-Password-Authentication"
  - name: ACR_REGISTRY
    value: "distrischooldevacr.azurecr.io"
  - name: NEXT_PUBLIC_API_URL
    value: "http://distrischool-api-gateway-dev.api-gateway-dev:80"
  - name: NEXT_PUBLIC_AUTH_SERVICE_URL
    value: "http://distrischool-api-gateway-dev.api-gateway-dev:80/api/auth"
  - name: NEXT_PUBLIC_STUDENT_SERVICE_URL
    value: "http://distrischool-api-gateway-dev.api-gateway-dev:80/api/students"
  - name: NEXT_PUBLIC_TEACHER_SERVICE_URL
    value: "http://distrischool-api-gateway-dev.api-gateway-dev:80/api/teachers"
  - name: JAVA_TOOL_OPTIONS
    value: "-XX:MaxRAMPercentage=65 -Xmx384m"

secrets:
  enabled: false
  secretName: "gestao-de-alunos-dev-secrets"
  # Secret 'gestao-de-alunos-dev-secrets' must be created externally in namespace 'gestao-de-alunos-dev'
  # Use: ./scripts/create-secrets.sh gestao-de-alunos gestao-de-alunos-dev
  # Comment out secretName above when secret doesn't exist to prevent pod failures
sealedSecrets:
  enabled: false
ingress:
  enabled: false
  className: ""
  hosts: []

probe:
  startup:
    enabled: true
    useTcpSocket: true  # Use TCP socket instead of HTTP - faster and checks if port is open
    path: /api/v1/students/health  # Only used if useTcpSocket is false
    initialDelaySeconds: 60
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 120  # Total: 60 + (120 * 10) = 1260 seconds = 21 minutes max startup time (increased for slow Spring Boot initialization)
  liveness:
    enabled: true
    useTcpSocket: true  # Use TCP socket instead of HTTP - avoids auth issues
    path: /api/v1/students/health  # Only used if useTcpSocket is false
    initialDelaySeconds: 120
    periodSeconds: 30
    timeoutSeconds: 5
    failureThreshold: 3
  readiness:
    enabled: true
    path: /api/v1/students/health
    initialDelaySeconds: 60
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

